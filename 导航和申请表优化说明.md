# 导航和申请表优化说明

## 修改内容

### 1. 删除导航栏的"表格申请"按钮

**文件**：`/app/launch-contest/page.tsx`

**修改前**：
- 导航栏有3个按钮：返回港湾、表格申请、了解比赛细节

**修改后**：
- 删除了"表格申请"按钮
- 只保留：返回港湾、了解比赛细节

**原因**：
- 简化导航
- 避免重复入口

---

### 2. 申请表链接智能禁用

**文件**：`/app/footprint/process/page.tsx`

**功能**：
- 在"参与流程"页面的第一步中，检查用户是否已提交申请表
- 如果已提交，"报名申请表"链接变为不可点击的灰色文本

**实现逻辑**：

```typescript
// 1. 添加状态管理
const [hasSubmittedApplication, setHasSubmittedApplication] = useState<boolean>(false);
const [isCheckingApplication, setIsCheckingApplication] = useState<boolean>(true);

// 2. 检查申请表状态
useEffect(() => {
  formService
    .getMyForms({ status: undefined, current: 1, pageSize: 1 })
    .then((response: any) => {
      const hasSubmitted = Boolean(response?.records && response.records.length > 0);
      setHasSubmittedApplication(hasSubmitted);
    })
    .catch(() => {
      setHasSubmittedApplication(false);
    })
    .finally(() => {
      setIsCheckingApplication(false);
    });
}, []);

// 3. 根据状态渲染不同内容
{hasSubmittedApplication ? (
  // 已提交：显示灰色不可点击文本
  <span className="text-gray-500 dark:text-gray-400 font-semibold mx-1 cursor-not-allowed">
    报名申请表（已提交）
  </span>
) : (
  // 未提交：显示可点击链接
  <Link
    href="/forms/application"
    className="text-blue-600 hover:text-blue-500 font-semibold underline decoration-dotted underline-offset-4 mx-1"
  >
    报名申请表
  </Link>
)}
```

---

## 用户体验改进

### 之前的问题

1. **导航栏混乱**
   - ❌ 多个入口导致用户困惑
   - ❌ "表格申请"与其他流程不一致

2. **申请表重复提交**
   - ❌ 用户可能重复点击申请表链接
   - ❌ 不知道是否已经提交过

### 现在的改进

1. **导航栏简洁**
   - ✅ 删除"表格申请"按钮
   - ✅ 保留核心功能入口
   - ✅ 用户通过"参与流程"页面进入申请流程

2. **申请表状态清晰**
   - ✅ 已提交用户看到灰色"报名申请表（已提交）"
   - ✅ 未提交用户看到蓝色可点击链接
   - ✅ 避免重复提交

---

## 视觉效果

### 未提交申请表时

```
填写 [报名申请表]，通过审核后即可解锁参与资格。
      ↑ 蓝色可点击链接
```

### 已提交申请表后

```
填写 报名申请表（已提交），通过审核后即可解锁参与资格。
      ↑ 灰色不可点击文本
```

---

## 技术细节

### 申请表状态检查

使用 `formService.getMyForms()` API：

```typescript
{
  status: undefined,  // 不限制状态
  current: 1,         // 第1页
  pageSize: 1         // 只需要1条记录
}
```

**判断逻辑**：
- 如果 `response.records.length > 0` → 已提交
- 否则 → 未提交

### 样式差异

**可点击链接**：
```css
className="text-blue-600 hover:text-blue-500 font-semibold underline decoration-dotted underline-offset-4 mx-1"
```

**不可点击文本**：
```css
className="text-gray-500 dark:text-gray-400 font-semibold mx-1 cursor-not-allowed"
```

---

## 多语言支持

### 中文
- 未提交：`报名申请表`
- 已提交：`报名申请表（已提交）`

### 英文
- 未提交：`enrollment application form`
- 已提交：`enrollment application form (submitted)`

---

## 测试场景

### 场景1：新用户访问（未提交）
1. 访问 `/footprint/process`
2. 看到蓝色可点击的"报名申请表"链接
3. 点击链接跳转到申请表页面

**预期**：✅ 可以正常点击

---

### 场景2：已提交用户访问
1. 用户已提交申请表
2. 访问 `/footprint/process`
3. 看到灰色的"报名申请表（已提交）"文本

**预期**：✅ 无法点击，显示已提交状态

---

### 场景3：launch-contest页面
1. 访问 `/launch-contest`
2. 只看到"返回港湾"和"了解比赛细节"按钮
3. 没有"表格申请"按钮

**预期**：✅ 导航栏更简洁

---

## 文件修改清单

### 修改的文件

1. **`/app/launch-contest/page.tsx`**
   - 删除"表格申请"按钮（130-138行）

2. **`/app/footprint/process/page.tsx`**
   - 添加申请表状态检查
   - 根据状态显示不同内容
   - 导入 `formService`

---

## 部署步骤

### 前端部署

```bash
cd ff-pf-frondend
npm run build
npm run start
```

### 验证

1. 清除浏览器缓存
2. 测试新用户流程
3. 测试已提交用户流程

---

## 注意事项

### 1. 状态检查时机

- 组件加载时立即检查
- 使用 `useEffect` 确保只检查一次

### 2. 错误处理

- 如果API调用失败，默认显示为未提交
- 用户仍然可以尝试提交

### 3. 性能优化

- 只请求1条记录（`pageSize: 1`）
- 减少网络开销

---

## 未来改进建议

### 1. 缓存优化

可以考虑缓存申请表状态，避免每次访问都请求API

### 2. 实时更新

用户在当前页面提交申请表后，自动更新状态

### 3. 加载状态

添加 loading 状态，提升用户体验

---

## 更新记录

- **2025-11-03 08:14**：导航和申请表优化
- **修改文件**：
  - `launch-contest/page.tsx`
  - `footprint/process/page.tsx`
- **核心变化**：删除导航栏"表格申请"按钮，申请表链接智能禁用
